<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3D Venue Viewer</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet"/>

  <!-- Model Viewer -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: 'Lexend', sans-serif;
      overflow: hidden;
    }

    model-viewer {
      width: 100vw;
      height: 100vh;
      background: #d8eafe;
    }

    .Hotspot {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border: 1px solid #0b111f;
      width: 20px;
      height: 20px;
      padding: 0;
      position: absolute;
      transform: translate3d(-50%, -50%, 0);
      cursor: pointer;
      border: none;
      backdrop-filter: blur(2px);
    }

    .HotspotAnnotation {
      display: none;
    }

    #popup {
      position: absolute;
      display: none;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      padding: 10px;
      font-size: 13px;
      max-width: 180px;
      z-index: 999;
      font-family: 'Lexend', sans-serif;
    }

    #popup::after {
      content: "";
      position: absolute;
      bottom: -10px;
      left: 20px;
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 10px solid #fff;
    }

    #popup-title {
      font-weight: bold;
      color: #3b8ee5;
    }

    #popup-price, #popup-desc {
      margin-top: 4px;
    }

    .side-buttons {
      position: absolute;
      top: 15px;
      left: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }

    .side-buttons button, #resetViewBtn {
      padding: 10px 16px;
      background: #3b8ee5;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-family: 'Lexend', sans-serif;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>

<body>

<model-viewer id="model"
  src="https://storage.googleapis.com/dzelzscela-muzejs-gltf-file-for-html/dzelzscela-muzejs-bez-jumta-compressed/dzelzscela_muzejs_v1-v1.glb"
  ar
  ar-modes="webxr scene-viewer quick-look"
  camera-controls
  auto-rotate
  shadow-intensity="0.97"
  exposure="1.03"
  shadow-softness="0.67"
  min-camera-orbit="auto 0deg auto"
  max-camera-orbit="auto 85deg auto"
  environment-image="legacy">

  <button class="Hotspot" slot="hotspot-1" data-position="-0.69m 5.59m -13.95m" data-normal="0 0 1" data-orbit="0deg 50deg 5m"
    data-visibility-attribute="visible"
    onclick="handleHotspotClick(this, 'LED Ekrāns', 'Ask for adjustment', 'LED screen positioned near the center.')">
    <div class="HotspotAnnotation">LED Ekrāns</div>
  </button>

  <button class="Hotspot" slot="hotspot-2" data-position="8.82m 6.14m -14.04m" data-normal="0.25 0 0.96" data-orbit="0deg 50deg 5m"
    data-visibility-attribute="visible"
    onclick="handleHotspotClick(this, 'Gaismu Konstrukcija', 'Ask for adjustment', 'Lighting rig setup for events.')">
    <div class="HotspotAnnotation">Gaismu Konstrukcija</div>
  </button>

  <button class="Hotspot" slot="hotspot-3" data-position="-2.63m 1.29m 1.23m" data-normal="0 1 0" data-orbit="0deg 50deg 5m"
    data-visibility-attribute="visible"
    onclick="handleHotspotClick(this, 'Apaļo galdu izkārtojums', 'Ask for adjustment', 'Round table layout for workshops or dining.')">
    <div class="HotspotAnnotation">Apaļo galdu izkārtojums</div>
  </button>

  <button class="Hotspot" slot="hotspot-4" data-position="-8.55m 1.51m -10.00m" data-normal="0 0 1" data-orbit="0deg 50deg 5m"
    data-visibility-attribute="visible"
    onclick="handleHotspotClick(this, 'Skaņas sistēma', '300 EUR + PVN', 'Premium sound system setup.')">
    <div class="HotspotAnnotation">Skaņas sistēma</div>
  </button>
</model-viewer>

<div class="side-buttons">
  <button onclick="goToHotspot('hotspot-1')">LED Ekrāns</button>
  <button onclick="goToHotspot('hotspot-2')">Gaismu Konstrukcija</button>
  <button onclick="goToHotspot('hotspot-3')">Apaļo galdu izkārtojums</button>
  <button onclick="goToHotspot('hotspot-4')">Skaņas sistēma</button>
  <button id="resetViewBtn">Reset View</button>
</div>

<!-- Popup Cloud -->
<div id="popup">
  <div id="popup-title"></div>
  <div id="popup-price"></div>
  <div id="popup-desc"></div>
</div>

<script>
  const modelViewer = document.getElementById('model');
  const popup = document.getElementById('popup');
  let activeHotspot = null;

  function handleHotspotClick(hotspot, title, price, desc) {
    const orbit = hotspot.dataset.orbit;
    const target = hotspot.dataset.position;

    if (orbit && target) {
      modelViewer.cameraTarget = target;
      modelViewer.cameraOrbit = orbit;
      modelViewer.autoRotate = false;
    }

    document.querySelectorAll('.Hotspot').forEach(h => h.removeAttribute('data-active'));
    hotspot.setAttribute('data-active', 'true');
    activeHotspot = hotspot;

    document.getElementById('popup-title').textContent = title;
    document.getElementById('popup-price').textContent = price;
    document.getElementById('popup-desc').textContent = desc;

    popup.style.display = 'block';
    updatePopupPosition();
  }

  function updatePopupPosition() {
    if (!activeHotspot) return;
    const rect = activeHotspot.getBoundingClientRect();
    popup.style.left = `${rect.left + rect.width / 2}px`;
    popup.style.top = `${rect.top - 90}px`;
  }

  function goToHotspot(slotName) {
    const hotspot = document.querySelector(`[slot="${slotName}"]`);
    if (hotspot) hotspot.click();
  }

  modelViewer.addEventListener('camera-change', updatePopupPosition);
  window.addEventListener('resize', updatePopupPosition);

  window.addEventListener('click', (e) => {
    if (!e.target.closest('.Hotspot')) {
      popup.style.display = 'none';
      activeHotspot = null;
    }
  });

  document.getElementById('resetViewBtn').addEventListener('click', () => {
    modelViewer.cameraOrbit = '0deg 50deg 5m';
    modelViewer.cameraTarget = '0m 0m 0m';
    modelViewer.autoRotate = true;
    popup.style.display = 'none';
    activeHotspot = null;
  });
</script>

</body>
</html>
